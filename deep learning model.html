<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Quality Prediction API</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding-top: 2rem;
            padding-bottom: 2rem;
            background-color: #f8f9fa;
        }
        .header {
            margin-bottom: 2rem;
            border-bottom: 1px solid #e5e5e5;
            padding-bottom: 1rem;
        }
        .card {
            margin-bottom: 1.5rem;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        }
        .metric-card {
            height: 100%;
        }
        .quality-badge {
            font-size: 1.2rem;
            padding: 0.5rem 1rem;
        }
        .excellent {
            background-color: #28a745;
        }
        .good {
            background-color: #17a2b8;
        }
        .moderate {
            background-color: #ffc107;
        }
        .poor {
            background-color: #dc3545;
        }
        .score-display {
            font-size: 3rem;
            font-weight: bold;
        }
        .feature-input {
            margin-bottom: 0.5rem;
        }
        #loading {
            display: none;
        }
        .chart-container {
            height: 300px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header text-center">
            <h1>Data Quality Prediction API</h1>
            <p class="lead">Enter dataset features to predict data quality metrics</p>
        </div>

        <div class="row">
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">Input Features</h5>
                    </div>
                    <div class="card-body">
                        <form id="predictionForm">
                            <div class="mb-3">
                                <button type="button" class="btn btn-outline-secondary btn-sm mb-3" id="loadSampleBtn">Load Sample Data</button>
                                <button type="button" class="btn btn-outline-primary btn-sm mb-3 ms-2" id="generateRandomBtn">Generate Random Data</button>
                                <button type="button" class="btn btn-outline-info btn-sm mb-3 ms-2" data-bs-toggle="modal" data-bs-target="#rangeSettingsModal">Configure Ranges</button>
                            </div>
                            
                            <!-- Basic Features -->
                            <h6>Basic Features</h6>
                            <div class="feature-input">
                                <label for="Row_Count" class="form-label">Row Count</label>
                                <input type="number" class="form-control form-control-sm" id="Row_Count" name="Row_Count" required data-min="100" data-max="100000">
                                <small class="text-muted">Range: 100-100,000</small>
                            </div>
                            <div class="feature-input">
                                <label for="Column_Count" class="form-label">Column Count</label>
                                <input type="number" class="form-control form-control-sm" id="Column_Count" name="Column_Count" required data-min="5" data-max="100">
                                <small class="text-muted">Range: 5-100</small>
                            </div>
                            <div class="feature-input">
                                <label for="File_Size_MB" class="form-label">File Size (MB)</label>
                                <input type="number" step="0.01" class="form-control form-control-sm" id="File_Size_MB" name="File_Size_MB" required data-min="0.1" data-max="1000">
                                <small class="text-muted">Range: 0.1-1000</small>
                            </div>
                            
                            <!-- Column Type Features -->
                            <h6 class="mt-3">Column Types</h6>
                            <div class="feature-input">
                                <label for="Numeric_Columns_Count" class="form-label">Numeric Columns</label>
                                <input type="number" class="form-control form-control-sm" id="Numeric_Columns_Count" name="Numeric_Columns_Count" required data-min="1" data-max="50">
                                <small class="text-muted">Range: 1-50</small>
                            </div>
                            <div class="feature-input">
                                <label for="Categorical_Columns_Count" class="form-label">Categorical Columns</label>
                                <input type="number" class="form-control form-control-sm" id="Categorical_Columns_Count" name="Categorical_Columns_Count" required data-min="0" data-max="30">
                                <small class="text-muted">Range: 0-30</small>
                            </div>
                            <div class="feature-input">
                                <label for="Date_Columns_Count" class="form-label">Date Columns</label>
                                <input type="number" class="form-control form-control-sm" id="Date_Columns_Count" name="Date_Columns_Count" required data-min="0" data-max="10">
                                <small class="text-muted">Range: 0-10</small>
                            </div>
                            
                            <!-- Data Quality Features -->
                            <h6 class="mt-3">Data Quality Metrics</h6>
                            <div class="feature-input">
                                <label for="Missing_Values_Pct" class="form-label">Missing Values (%)</label>
                                <input type="number" step="0.01" class="form-control form-control-sm" id="Missing_Values_Pct" name="Missing_Values_Pct" required data-min="0" data-max="50">
                                <small class="text-muted">Range: 0-50%</small>
                            </div>
                            <div class="feature-input">
                                <label for="Duplicate_Records_Count" class="form-label">Duplicate Records</label>
                                <input type="number" class="form-control form-control-sm" id="Duplicate_Records_Count" name="Duplicate_Records_Count" required data-min="0" data-max="5000">
                                <small class="text-muted">Range: 0-5000</small>
                            </div>
                            <div class="feature-input">
                                <label for="Outlier_Rate" class="form-label">Outlier Rate</label>
                                <input type="number" step="0.01" class="form-control form-control-sm" id="Outlier_Rate" name="Outlier_Rate" required data-min="0" data-max="0.5">
                                <small class="text-muted">Range: 0-0.5</small>
                            </div>
                            
                            <!-- Advanced Features (collapsed by default) -->
                            <div class="mt-3">
                                <button class="btn btn-outline-secondary btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#advancedFeatures">
                                    Show Advanced Features
                                </button>
                            </div>
                            
                            <div class="collapse mt-3" id="advancedFeatures">
                                <div class="feature-input">
                                    <label for="Inconsistency_Rate" class="form-label">Inconsistency Rate</label>
                                    <input type="number" step="0.01" class="form-control form-control-sm" id="Inconsistency_Rate" name="Inconsistency_Rate" required>
                                </div>
                                <div class="feature-input">
                                    <label for="Data_Type_Mismatch_Rate" class="form-label">Data Type Mismatch Rate</label>
                                    <input type="number" step="0.01" class="form-control form-control-sm" id="Data_Type_Mismatch_Rate" name="Data_Type_Mismatch_Rate" required>
                                </div>
                                <div class="feature-input">
                                    <label for="Null_vs_NaN_Distribution" class="form-label">Null vs NaN Distribution</label>
                                    <input type="number" step="0.01" class="form-control form-control-sm" id="Null_vs_NaN_Distribution" name="Null_vs_NaN_Distribution" required>
                                </div>
                                <div class="feature-input">
                                    <label for="Cardinality_Categorical" class="form-label">Cardinality Categorical</label>
                                    <input type="number" class="form-control form-control-sm" id="Cardinality_Categorical" name="Cardinality_Categorical" required>
                                </div>
                                <div class="feature-input">
                                    <label for="Target_Imbalance" class="form-label">Target Imbalance</label>
                                    <input type="number" step="0.01" class="form-control form-control-sm" id="Target_Imbalance" name="Target_Imbalance" required>
                                </div>
                                <div class="feature-input">
                                    <label for="Feature_Importance_Consistency" class="form-label">Feature Importance Consistency</label>
                                    <input type="number" step="0.01" class="form-control form-control-sm" id="Feature_Importance_Consistency" name="Feature_Importance_Consistency" required>
                                </div>
                                <div class="feature-input">
                                    <label for="Class_Overlap_Score" class="form-label">Class Overlap Score</label>
                                    <input type="number" step="0.01" class="form-control form-control-sm" id="Class_Overlap_Score" name="Class_Overlap_Score" required>
                                </div>
                                <div class="feature-input">
                                    <label for="Label_Noise_Rate" class="form-label">Label Noise Rate</label>
                                    <input type="number" step="0.01" class="form-control form-control-sm" id="Label_Noise_Rate" name="Label_Noise_Rate" required>
                                </div>
                                <div class="feature-input">
                                    <label for="Feature_Correlation_Mean" class="form-label">Feature Correlation Mean</label>
                                    <input type="number" step="0.01" class="form-control form-control-sm" id="Feature_Correlation_Mean" name="Feature_Correlation_Mean" required>
                                </div>
                                <div class="feature-input">
                                    <label for="Range_Violation_Rate" class="form-label">Range Violation Rate</label>
                                    <input type="number" step="0.01" class="form-control form-control-sm" id="Range_Violation_Rate" name="Range_Violation_Rate" required>
                                </div>
                                <div class="feature-input">
                                    <label for="Mean_Median_Drift" class="form-label">Mean Median Drift</label>
                                    <input type="number" step="0.01" class="form-control form-control-sm" id="Mean_Median_Drift" name="Mean_Median_Drift" required>
                                </div>
                                <div class="feature-input">
                                    <label for="Data_Freshness" class="form-label">Data Freshness</label>
                                    <input type="number" step="0.01" class="form-control form-control-sm" id="Data_Freshness" name="Data_Freshness" required>
                                </div>
                                <div class="feature-input">
                                    <label for="Anomaly_Count" class="form-label">Anomaly Count</label>
                                    <input type="number" class="form-control form-control-sm" id="Anomaly_Count" name="Anomaly_Count" required>
                                </div>
                                <div class="feature-input">
                                    <label for="Encoding_Coverage_Rate" class="form-label">Encoding Coverage Rate</label>
                                    <input type="number" step="0.01" class="form-control form-control-sm" id="Encoding_Coverage_Rate" name="Encoding_Coverage_Rate" required>
                                </div>
                                <div class="feature-input">
                                    <label for="Variance_Threshold_Check" class="form-label">Variance Threshold Check</label>
                                    <input type="number" step="0.01" class="form-control form-control-sm" id="Variance_Threshold_Check" name="Variance_Threshold_Check" required>
                                </div>
                                <div class="feature-input">
                                    <label for="Data_Density_Completeness" class="form-label">Data Density Completeness</label>
                                    <input type="number" step="0.01" class="form-control form-control-sm" id="Data_Density_Completeness" name="Data_Density_Completeness" required>
                                </div>
                                <div class="feature-input">
                                    <label for="Domain_Constraint_Violations" class="form-label">Domain Constraint Violations</label>
                                    <input type="number" class="form-control form-control-sm" id="Domain_Constraint_Violations" name="Domain_Constraint_Violations" required>
                                </div>
                            </div>
                            
                            <div class="mt-3">
                                <button type="submit" class="btn btn-primary">Predict Quality</button>
                                <div id="loading" class="spinner-border text-primary mt-2" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <div class="col-md-8">
                <div id="resultsSection" style="display: none;">
                    <!-- Overall Score Card -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-primary text-white">
                                    <h5 class="mb-0">Overall Quality Score</h5>
                                </div>
                                <div class="card-body text-center">
                                    <div class="score-display" id="overallScore">--</div>
                                    <div class="progress mt-2">
                                        <div class="progress-bar" id="scoreProgressBar" role="progressbar" style="width: 0%"></div>
                                    </div>
                                    <div class="mt-2 text-muted small" id="scoreNote"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-primary text-white">
                                    <h5 class="mb-0">Quality Label</h5>
                                </div>
                                <div class="card-body text-center">
                                    <span class="badge quality-badge" id="qualityLabel">--</span>
                                    <div class="mt-3">
                                        <h6>Label Probabilities</h6>
                                        <div id="labelProbabilities"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Top Issues Card -->
                    <div class="card mt-3">
                        <div class="card-header bg-warning text-white">
                            <h5 class="mb-0">Top Issues</h5>
                        </div>
                        <div class="card-body">
                            <div id="topIssues"></div>
                        </div>
                    </div>
                    
                    <!-- Metric Scores Chart -->
                    <div class="card mt-3">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0">Metric Scores</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="metricScoresChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- All Metrics Table -->
                    <div class="card mt-3">
                        <div class="card-header bg-secondary text-white">
                            <h5 class="mb-0">All Metric Scores</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover" id="metricsTable">
                                    <thead>
                                        <tr>
                                            <th>Metric</th>
                                            <th>Score</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="metricsTableBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- API Info Card (shown when no results) -->
                <div id="apiInfoSection">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">Data Quality Prediction API</h5>
                        </div>
                        <div class="card-body">
                            <h5>Welcome to the Data Quality Prediction API</h5>
                            <p>This API uses TabNet models to predict data quality metrics for your datasets. Enter the dataset features in the form to get predictions.</p>
                            
                            <h6>Features:</h6>
                            <ul>
                                <li>Overall data quality score (0-100)</li>
                                <li>Quality label (Excellent, Good, Moderate, Poor)</li>
                                <li>Individual metric scores</li>
                                <li>Top issues identification</li>
                            </ul>
                            
                            <h6>API Endpoints:</h6>
                            <ul>
                                <li><code>/predict</code> - POST endpoint for making predictions</li>
                                <li><code>/metadata</code> - GET endpoint for model metadata</li>
                                <li><code>/sample-input</code> - GET endpoint for sample input format</li>
                                <li><code>/health</code> - GET endpoint for API health check</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Range Configuration Modal -->
    <div class="modal fade" id="rangeSettingsModal" tabindex="-1" aria-labelledby="rangeSettingsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="rangeSettingsModalLabel">Configure Input Ranges</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Set the minimum and maximum values for each input feature. These ranges will be used when generating random data.</p>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Basic Features</h6>
                            <div class="mb-3 row">
                                <label class="col-sm-6 col-form-label">Row Count</label>
                                <div class="col-sm-3">
                                    <input type="number" class="form-control form-control-sm range-min" data-target="Row_Count" value="100">
                                </div>
                                <div class="col-sm-3">
                                    <input type="number" class="form-control form-control-sm range-max" data-target="Row_Count" value="100000">
                                </div>
                            </div>
                            <div class="mb-3 row">
                                <label class="col-sm-6 col-form-label">Column Count</label>
                                <div class="col-sm-3">
                                    <input type="number" class="form-control form-control-sm range-min" data-target="Column_Count" value="5">
                                </div>
                                <div class="col-sm-3">
                                    <input type="number" class="form-control form-control-sm range-max" data-target="Column_Count" value="100">
                                </div>
                            </div>
                            <div class="mb-3 row">
                                <label class="col-sm-6 col-form-label">File Size (MB)</label>
                                <div class="col-sm-3">
                                    <input type="number" step="0.01" class="form-control form-control-sm range-min" data-target="File_Size_MB" value="0.1">
                                </div>
                                <div class="col-sm-3">
                                    <input type="number" step="0.01" class="form-control form-control-sm range-max" data-target="File_Size_MB" value="1000">
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <h6>Column Types</h6>
                            <div class="mb-3 row">
                                <label class="col-sm-6 col-form-label">Numeric Columns</label>
                                <div class="col-sm-3">
                                    <input type="number" class="form-control form-control-sm range-min" data-target="Numeric_Columns_Count" value="1">
                                </div>
                                <div class="col-sm-3">
                                    <input type="number" class="form-control form-control-sm range-max" data-target="Numeric_Columns_Count" value="50">
                                </div>
                            </div>
                            <div class="mb-3 row">
                                <label class="col-sm-6 col-form-label">Categorical Columns</label>
                                <div class="col-sm-3">
                                    <input type="number" class="form-control form-control-sm range-min" data-target="Categorical_Columns_Count" value="0">
                                </div>
                                <div class="col-sm-3">
                                    <input type="number" class="form-control form-control-sm range-max" data-target="Categorical_Columns_Count" value="30">
                                </div>
                            </div>
                            <div class="mb-3 row">
                                <label class="col-sm-6 col-form-label">Date Columns</label>
                                <div class="col-sm-3">
                                    <input type="number" class="form-control form-control-sm range-min" data-target="Date_Columns_Count" value="0">
                                </div>
                                <div class="col-sm-3">
                                    <input type="number" class="form-control form-control-sm range-max" data-target="Date_Columns_Count" value="10">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <h6>Data Quality Metrics</h6>
                            <div class="mb-3 row">
                                <label class="col-sm-6 col-form-label">Missing Values (%)</label>
                                <div class="col-sm-3">
                                    <input type="number" step="0.01" class="form-control form-control-sm range-min" data-target="Missing_Values_Pct" value="0">
                                </div>
                                <div class="col-sm-3">
                                    <input type="number" step="0.01" class="form-control form-control-sm range-max" data-target="Missing_Values_Pct" value="50">
                                </div>
                            </div>
                            <div class="mb-3 row">
                                <label class="col-sm-6 col-form-label">Duplicate Records</label>
                                <div class="col-sm-3">
                                    <input type="number" class="form-control form-control-sm range-min" data-target="Duplicate_Records_Count" value="0">
                                </div>
                                <div class="col-sm-3">
                                    <input type="number" class="form-control form-control-sm range-max" data-target="Duplicate_Records_Count" value="5000">
                                </div>
                            </div>
                            <div class="mb-3 row">
                                <label class="col-sm-6 col-form-label">Outlier Rate</label>
                                <div class="col-sm-3">
                                    <input type="number" step="0.01" class="form-control form-control-sm range-min" data-target="Outlier_Rate" value="0">
                                </div>
                                <div class="col-sm-3">
                                    <input type="number" step="0.01" class="form-control form-control-sm range-max" data-target="Outlier_Rate" value="0.5">
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <h6>Advanced Features</h6>
                            <div class="mb-3 row">
                                <label class="col-sm-6 col-form-label">Data Freshness</label>
                                <div class="col-sm-3">
                                    <input type="number" step="0.01" class="form-control form-control-sm range-min" data-target="Data_Freshness" value="0">
                                </div>
                                <div class="col-sm-3">
                                    <input type="number" step="0.01" class="form-control form-control-sm range-max" data-target="Data_Freshness" value="1">
                                </div>
                            </div>
                            <div class="mb-3 row">
                                <label class="col-sm-6 col-form-label">Feature Correlation Mean</label>
                                <div class="col-sm-3">
                                    <input type="number" step="0.01" class="form-control form-control-sm range-min" data-target="Feature_Correlation_Mean" value="0">
                                </div>
                                <div class="col-sm-3">
                                    <input type="number" step="0.01" class="form-control form-control-sm range-max" data-target="Feature_Correlation_Mean" value="1">
                                </div>
                            </div>
                            <div class="mb-3 row">
                                <label class="col-sm-6 col-form-label">Feature Importance Consistency</label>
                                <div class="col-sm-3">
                                    <input type="number" step="0.01" class="form-control form-control-sm range-min" data-target="Feature_Importance_Consistency" value="0">
                                </div>
                                <div class="col-sm-3">
                                    <input type="number" step="0.01" class="form-control form-control-sm range-max" data-target="Feature_Importance_Consistency" value="1">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveRangesBtn">Save Ranges</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        // Sample data for quick testing
        const sampleData = {
            "Row_Count": 50000,
            "Column_Count": 20,
            "File_Size_MB": 45.2,
            "Numeric_Columns_Count": 14,
            "Categorical_Columns_Count": 4,
            "Date_Columns_Count": 2,
            "Missing_Values_Pct": 1.2,
            "Duplicate_Records_Count": 20,
            "Outlier_Rate": 0.02,
            "Inconsistency_Rate": 0.01,
            "Data_Type_Mismatch_Rate": 0.005,
            "Null_vs_NaN_Distribution": 0.9,
            "Cardinality_Categorical": 50,
            "Target_Imbalance": 0.48,
            "Feature_Importance_Consistency": 0.92,
            "Class_Overlap_Score": 0.1,
            "Label_Noise_Rate": 0.01,
            "Feature_Correlation_Mean": 0.3,
            "Range_Violation_Rate": 0.005,
            "Mean_Median_Drift": 0.05,
            "Data_Freshness": 0.98,
            "Anomaly_Count": 15,
            "Encoding_Coverage_Rate": 0.99,
            "Variance_Threshold_Check": 0.95,
            "Data_Density_Completeness": 0.98,
            "Domain_Constraint_Violations": 5
        };
        
        // Default ranges for all features
        const defaultRanges = {
            "Row_Count": { min: 100, max: 100000 },
            "Column_Count": { min: 5, max: 100 },
            "File_Size_MB": { min: 0.1, max: 1000 },
            "Numeric_Columns_Count": { min: 1, max: 50 },
            "Categorical_Columns_Count": { min: 0, max: 30 },
            "Date_Columns_Count": { min: 0, max: 10 },
            "Missing_Values_Pct": { min: 0, max: 50 },
            "Duplicate_Records_Count": { min: 0, max: 5000 },
            "Outlier_Rate": { min: 0, max: 0.5 },
            "Inconsistency_Rate": { min: 0, max: 0.5 },
            "Data_Type_Mismatch_Rate": { min: 0, max: 0.5 },
            "Null_vs_NaN_Distribution": { min: 0, max: 1 },
            "Cardinality_Categorical": { min: 1, max: 1000 },
            "Target_Imbalance": { min: 0, max: 1 },
            "Feature_Importance_Consistency": { min: 0, max: 1 },
            "Class_Overlap_Score": { min: 0, max: 1 },
            "Label_Noise_Rate": { min: 0, max: 0.5 },
            "Feature_Correlation_Mean": { min: 0, max: 1 },
            "Range_Violation_Rate": { min: 0, max: 0.5 },
            "Mean_Median_Drift": { min: 0, max: 1 },
            "Data_Freshness": { min: 0, max: 1 },
            "Anomaly_Count": { min: 0, max: 1000 },
            "Encoding_Coverage_Rate": { min: 0, max: 1 },
            "Variance_Threshold_Check": { min: 0, max: 1 },
            "Data_Density_Completeness": { min: 0, max: 1 },
            "Domain_Constraint_Violations": { min: 0, max: 1000 }
        };
        
        // Current ranges (can be modified by user)
        let currentRanges = JSON.parse(JSON.stringify(defaultRanges));
        
        // Function to generate a random number within a range
        function randomInRange(min, max, isInteger = false, decimals = 2) {
            const random = Math.random() * (max - min) + min;
            if (isInteger) {
                return Math.floor(random);
            } else {
                return parseFloat(random.toFixed(decimals));
            }
        }
        
        // Function to generate random data based on current ranges
        function generateRandomData() {
            const randomData = {};
            
            // Generate random values for each input field based on its range
            for (const [key, range] of Object.entries(currentRanges)) {
                const input = document.getElementById(key);
                if (input) {
                    // Determine if the field should be an integer or float
                    const isInteger = input.step === "1" || !input.step;
                    const decimals = key.includes('Rate') || key.includes('Pct') || key.includes('Mean') || 
                                    key.includes('Consistency') || key.includes('Distribution') || 
                                    key.includes('Completeness') || key.includes('Threshold') || 
                                    key.includes('Imbalance') || key.includes('Score') || 
                                    key.includes('Freshness') || key.includes('MB') ? 2 : 0;
                    
                    randomData[key] = randomInRange(range.min, range.max, isInteger, decimals);
                }
            }
            
            return randomData;
        }
        
        // Load sample data button
        document.getElementById('loadSampleBtn').addEventListener('click', function() {
            for (const [key, value] of Object.entries(sampleData)) {
                const input = document.getElementById(key);
                if (input) {
                    input.value = value;
                }
            }
        });
        
        // Generate random data button
        document.getElementById('generateRandomBtn').addEventListener('click', function() {
            const randomData = generateRandomData();
            for (const [key, value] of Object.entries(randomData)) {
                const input = document.getElementById(key);
                if (input) {
                    input.value = value;
                }
            }
        });
        
        // Initialize range settings modal
        function initRangeSettings() {
            // Set initial values in the modal
            document.querySelectorAll('.range-min, .range-max').forEach(input => {
                const targetField = input.getAttribute('data-target');
                const isMin = input.classList.contains('range-min');
                
                if (targetField && currentRanges[targetField]) {
                    input.value = isMin ? currentRanges[targetField].min : currentRanges[targetField].max;
                }
                
                // Add event listeners to update ranges when values change
                input.addEventListener('change', function() {
                    const target = this.getAttribute('data-target');
                    const isMinInput = this.classList.contains('range-min');
                    const value = parseFloat(this.value);
                    
                    if (target && !isNaN(value)) {
                        if (isMinInput) {
                            currentRanges[target].min = value;
                        } else {
                            currentRanges[target].max = value;
                        }
                    }
                });
            });
        }
        
        // Save ranges button
        document.getElementById('saveRangesBtn').addEventListener('click', function() {
            // Update the data-min and data-max attributes on all input fields
            for (const [key, range] of Object.entries(currentRanges)) {
                const input = document.getElementById(key);
                if (input) {
                    input.setAttribute('data-min', range.min);
                    input.setAttribute('data-max', range.max);
                    
                    // Update the range text below the input
                    const parent = input.parentElement;
                    const rangeText = parent.querySelector('small.text-muted');
                    if (rangeText) {
                        rangeText.textContent = `Range: ${range.min}-${range.max}`;
                    }
                }
            }
            
            // Close the modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('rangeSettingsModal'));
            modal.hide();
            
            // Show success message
            alert('Ranges saved successfully!');
        });
        
        // Initialize range settings when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            initRangeSettings();
        });
        
        // Form submission
        document.getElementById('predictionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Show loading spinner
            document.getElementById('loading').style.display = 'inline-block';
            
            // Get form data
            const formData = new FormData(this);
            const jsonData = {};
            
            for (const [key, value] of formData.entries()) {
                // Convert numeric values to numbers
                jsonData[key] = isNaN(value) ? value : Number(value);
            }
            
            try {
                // Make API call
                // Change this URL to your Render deployment URL when deployed
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(jsonData)
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                const result = await response.json();
                
                // Hide API info and show results
                document.getElementById('apiInfoSection').style.display = 'none';
                document.getElementById('resultsSection').style.display = 'block';
                
                // Display results
                displayResults(result);
            } catch (error) {
                console.error('Error:', error);
                alert(`Error: ${error.message}`);
            } finally {
                // Hide loading spinner
                document.getElementById('loading').style.display = 'none';
            }
        });
        
        // Function to display results
        function displayResults(data) {
            // Display overall score
            const scoreElement = document.getElementById('overallScore');
            scoreElement.textContent = data.overall_score.toFixed(1);
            
            // Update progress bar
            const progressBar = document.getElementById('scoreProgressBar');
            progressBar.style.width = `${data.overall_score}%`;
            
            // Set progress bar color based on score
            if (data.overall_score >= 90) {
                progressBar.className = 'progress-bar bg-success';
            } else if (data.overall_score >= 70) {
                progressBar.className = 'progress-bar bg-info';
            } else if (data.overall_score >= 50) {
                progressBar.className = 'progress-bar bg-warning';
            } else {
                progressBar.className = 'progress-bar bg-danger';
            }
            
            // Display score note if available
            const scoreNoteElement = document.getElementById('scoreNote');
            if (data.score_note) {
                scoreNoteElement.textContent = data.score_note;
                scoreNoteElement.style.display = 'block';
            } else {
                scoreNoteElement.style.display = 'none';
            }
            
            // Display quality label
            const labelElement = document.getElementById('qualityLabel');
            labelElement.textContent = data.quality_label;
            
            // Set label color
            labelElement.className = 'badge quality-badge';
            if (data.quality_label === 'Excellent') {
                labelElement.classList.add('excellent');
            } else if (data.quality_label === 'Good') {
                labelElement.classList.add('good');
            } else if (data.quality_label === 'Moderate') {
                labelElement.classList.add('moderate');
            } else {
                labelElement.classList.add('poor');
            }
            
            // Display label probabilities
            const probElement = document.getElementById('labelProbabilities');
            probElement.innerHTML = '';
            
            for (const [label, prob] of Object.entries(data.label_probabilities)) {
                const probBar = document.createElement('div');
                probBar.className = 'mb-1';
                probBar.innerHTML = `
                    <div class="d-flex justify-content-between">
                        <small>${label}</small>
                        <small>${(prob * 100).toFixed(1)}%</small>
                    </div>
                    <div class="progress" style="height: 10px;">
                        <div class="progress-bar ${getLabelClass(label)}" role="progressbar" 
                             style="width: ${prob * 100}%" aria-valuenow="${prob * 100}" 
                             aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                `;
                probElement.appendChild(probBar);
            }
            
            // Display top issues
            const issuesElement = document.getElementById('topIssues');
            issuesElement.innerHTML = '';
            
            for (const [metric, score] of Object.entries(data.top_issues)) {
                const issueRow = document.createElement('div');
                issueRow.className = 'mb-2';
                issueRow.innerHTML = `
                    <div class="d-flex justify-content-between">
                        <span>${formatMetricName(metric)}</span>
                        <span class="badge ${getScoreBadgeClass(score)}">${score.toFixed(1)}</span>
                    </div>
                    <div class="progress" style="height: 8px;">
                        <div class="progress-bar ${getScoreProgressClass(score)}" role="progressbar" 
                             style="width: ${score}%" aria-valuenow="${score}" 
                             aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                `;
                issuesElement.appendChild(issueRow);
            }
            
            // Display all metrics in table
            const tableBody = document.getElementById('metricsTableBody');
            tableBody.innerHTML = '';
            
            // Sort metrics by score (ascending)
            const sortedMetrics = Object.entries(data.metric_scores).sort((a, b) => a[1] - b[1]);
            
            for (const [metric, score] of sortedMetrics) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatMetricName(metric)}</td>
                    <td>${score.toFixed(1)}</td>
                    <td><span class="badge ${getScoreBadgeClass(score)}">${getScoreStatus(score)}</span></td>
                `;
                tableBody.appendChild(row);
            }
            
            // Create chart for metric scores
            createMetricChart(data.metric_scores);
        }
        
        // Helper functions
        function formatMetricName(metric) {
            return metric.replace(/_/g, ' ');
        }
        
        function getLabelClass(label) {
            switch (label) {
                case 'Excellent': return 'bg-success';
                case 'Good': return 'bg-info';
                case 'Moderate': return 'bg-warning';
                case 'Poor': return 'bg-danger';
                default: return 'bg-secondary';
            }
        }
        
        function getScoreBadgeClass(score) {
            if (score >= 90) return 'bg-success';
            if (score >= 70) return 'bg-info';
            if (score >= 50) return 'bg-warning';
            return 'bg-danger';
        }
        
        function getScoreProgressClass(score) {
            if (score >= 90) return 'bg-success';
            if (score >= 70) return 'bg-info';
            if (score >= 50) return 'bg-warning';
            return 'bg-danger';
        }
        
        function getScoreStatus(score) {
            if (score >= 90) return 'Excellent';
            if (score >= 70) return 'Good';
            if (score >= 50) return 'Moderate';
            return 'Poor';
        }
        
        // Chart for metric scores
        let metricChart = null;
        
        function createMetricChart(metricScores) {
            const ctx = document.getElementById('metricScoresChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (metricChart) {
                metricChart.destroy();
            }
            
            // Get top 10 metrics (5 best and 5 worst)
            const sortedMetrics = Object.entries(metricScores).sort((a, b) => a[1] - b[1]);
            const worstMetrics = sortedMetrics.slice(0, 5);
            const bestMetrics = sortedMetrics.slice(-5).reverse();
            
            const selectedMetrics = [...worstMetrics, ...bestMetrics];
            const labels = selectedMetrics.map(([metric, _]) => formatMetricName(metric));
            const scores = selectedMetrics.map(([_, score]) => score);
            const colors = scores.map(score => {
                if (score >= 90) return 'rgba(40, 167, 69, 0.7)';
                if (score >= 70) return 'rgba(23, 162, 184, 0.7)';
                if (score >= 50) return 'rgba(255, 193, 7, 0.7)';
                return 'rgba(220, 53, 69, 0.7)';
            });
            
            metricChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Metric Scores',
                        data: scores,
                        backgroundColor: colors,
                        borderColor: colors.map(color => color.replace('0.7', '1')),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Score'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Metrics'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Score: ${context.raw.toFixed(1)}`;
                                }
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
